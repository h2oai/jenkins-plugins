<j:jelly xmlns:j="jelly:core" xmlns:st="jelly:stapler" xmlns:l="/lib/layout" xmlns:t="/lib/hudson" xmlns:dp="/hudson/plugins/view/dashboard">
<style scoped="scoped">
a:link {text-decoration:none; color: inherit;}
a:visited {text-decoration:none; color: inherit;}
a:hover {text-decoration:none; color: inherit;}
a:active {text-decoration:none; color: inherit;}

.clearfix:after {
    content: ".";
    display: block;
    height: 0;
    clear: both;
    visibility: hidden;
}

.rounded-corners {
-webkit-border-radius: .5em;
-moz-border-radius: .5em;
border-radius: .5em;
}

.testpack {
margin: 1.3%;
width: 90%;
height: auto;
padding: 10px;
border: 1px solid #444;
position: relative;
}

.testpack p {
font-size: 2em;
margin: 0px;
overflow: hidden;
white-space: nowrap;
text-overflow: ellipsis;
-o-text-overflow: ellipsis;
}

.test {
color: white;
font-size: 1.1em;
overflow: hidden;
white-space: nowrap;
text-overflow: ellipsis;
-o-text-overflow: ellipsis;
float: left;
margin: 1.2%;
width: 160px;
height: 40px;
padding: 10px;
position: relative;

border-radius: .5em;
-webkit-box-shadow: 0 3px 6px rgba(0,0,0,.4);
-moz-box-shadow: 0 3px 6px rgba(0,0,0,.4);
box-shadow: 0 3px 6px rgba(0,0,0,.4);
}

.packageFailed {
border: solid 1px #d81b21;
background: #f8dddd;
}

.testOk {
border: solid 1px #007600;
background: #009511;
}

.testFailed {
border: solid 1px #980c10;
background: #d81b21;
}


.testSkipped {
border: solid 1px #555;
background: #6e6e6e;
}

.trend { 
 position: absolute; right: 10px; top: 10px;
}

.trendbt { 
 position: absolute; right: 10px; bottom: 10px;
}

.trend img { margin: 2px;}
.trendbt img { margin: 2px;}
</style>

<j:forEach var="job" items="${jobs}">
  <j:set var="testResultsBean" value="${it.getJobTestLastRunResults(job)}" />
  <j:forEach var="pack" items="${testResultsBean.packages}">
  <j:choose>
  <j:when test="${pack.getFailCount()>0}"><j:set var="pclass" value="packageFailed" /></j:when>
  <j:otherwise><j:set var="pclass" value="" /></j:otherwise>
  </j:choose>
  <div class="${pclass} testpack rounded-corners clearfix">    
    <p><a href="${testResultsBean.getURL(pack)}" title="Package detail" >Test package ${pack.name}</a></p>   
    <j:forEach var="test" items="${testResultsBean.getCaseResults(pack)}">
        <j:choose>
        <j:when test="${test.isPassed()}"><j:set var="tclass" value="testOk" /></j:when>
        <j:when test="${test.isSkipped()}"><j:set var="tclass" value="testSkipped" /></j:when>
        <j:otherwise><j:set var="tclass" value="testFailed" /></j:otherwise>
        </j:choose>
        <div class="test ${tclass}">
        <a href="${testResultsBean.getURL(test)}" title="Test detail">${test.name}</a>
        <div class="trendbt">
        <a href="${testResultsBean.getURL(test)}" title="Test detail"><img src="${rootURL}/plugin/h2o-dashboard/images/detail.png" alt="Click to see test details..." /></a>
        <a href="${testResultsBean.getURL(test)}/history" title="Test history"><img src="${rootURL}/plugin/h2o-dashboard/images/trend.png" alt="Click to see trends..." /></a></div>
        </div>
    </j:forEach>
    <div class="trend">
    <a href="${testResultsBean.getURL(pack)}" title="Package detail"><img src="${rootURL}/plugin/h2o-dashboard/images/detail.png" alt="Click to see test details..." /></a>
    <a href="${testResultsBean.getURL(pack)}/history" title="Package history"><img src="${rootURL}/plugin/h2o-dashboard/images/trend.png" alt="Click to see trends..." /></a>
    </div>
  </div>  
  </j:forEach>
</j:forEach>
</j:jelly>
